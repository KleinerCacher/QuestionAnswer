DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'Hbs.Web.QuestionAnswer.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201705120828540_AutomaticMigration'
BEGIN
    CREATE TABLE [dbo].[AnswerAttachments] (
        [Id] [int] NOT NULL IDENTITY,
        [AnswerId] [int] NOT NULL,
        [Data] [varbinary](max),
        [FileType] [int] NOT NULL,
        [Name] [nvarchar](max),
        CONSTRAINT [PK_dbo.AnswerAttachments] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Answers] (
        [Id] [int] NOT NULL IDENTITY,
        [QuestionId] [int] NOT NULL,
        [Text] [nvarchar](max),
        [Author] [nvarchar](max),
        [CreationDate] [datetime] NOT NULL,
        [ModifiedDate] [datetime],
        [IsCorrectAnswer] [bit] NOT NULL,
        CONSTRAINT [PK_dbo.Answers] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Questions] (
        [Id] [int] NOT NULL IDENTITY,
        [Title] [nvarchar](max),
        [Author] [nvarchar](max),
        [Text] [nvarchar](max),
        [CreationDate] [datetime] NOT NULL,
        [ModifiedDate] [datetime],
        CONSTRAINT [PK_dbo.Questions] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[QuestionAttachments] (
        [Id] [int] NOT NULL IDENTITY,
        [QuestionId] [int] NOT NULL,
        [Data] [varbinary](max),
        [FileType] [int] NOT NULL,
        [Name] [nvarchar](max),
        CONSTRAINT [PK_dbo.QuestionAttachments] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_AnswerId] ON [dbo].[AnswerAttachments]([AnswerId])
    CREATE INDEX [IX_QuestionId] ON [dbo].[Answers]([QuestionId])
    CREATE INDEX [IX_QuestionId] ON [dbo].[QuestionAttachments]([QuestionId])
    ALTER TABLE [dbo].[AnswerAttachments] ADD CONSTRAINT [FK_dbo.AnswerAttachments_dbo.Answers_AnswerId] FOREIGN KEY ([AnswerId]) REFERENCES [dbo].[Answers] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[Answers] ADD CONSTRAINT [FK_dbo.Answers_dbo.Questions_QuestionId] FOREIGN KEY ([QuestionId]) REFERENCES [dbo].[Questions] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[QuestionAttachments] ADD CONSTRAINT [FK_dbo.QuestionAttachments_dbo.Questions_QuestionId] FOREIGN KEY ([QuestionId]) REFERENCES [dbo].[Questions] ([Id]) ON DELETE CASCADE
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201705120828540_AutomaticMigration', N'Hbs.Web.QuestionAnswer.Migrations.Configuration',  0x1F8B0800000000000400ED5CCD6EE33610BE17E83B083AB545364AB29736B07791759236EDE6A7B1B3ED2DA025DA2196A25492CADA28FA643DF491FA0AA5FE295194E858B1DD205860A1F0678633F3CD70484EF2EFDFFF0CDE2F7C6C3D42CA504086F6E1FE816D41E2061E22F3A11DF1D99BEFEDF7EFBEFE6A70E6F90BEB533EEE6D3C4ECC246C683F701E1E3B0E731FA00FD8BE8F5C1AB060C6F7DDC0778017384707073F3887870E14246C41CBB206B711E1C887C90FE2C751405C18F208E0CBC0839865EDA2679C50B5AE800F59085C38B47F9AB2FDDFE074FFD708322E167342D81748F74F0107B6758211104B1A433CB32D4048C0413CE6F88EC131A701998F43D100F0641942316E0630839920C7E57053990E8E62999C72624ECA8D180FFC15091EBECD94E4D4A73F49D576A144A1C633A16EBE8CA54E5439B453AD9D700EDC071F126E5B75A6C7234CE3095A8DA7A6DA2F6988EF1AD53DAB79EE5E812401B8F8DF9E358A308F281C1218710AF09E75134D31727F81CB49F019922189309645124289BE4A8368BAA14108295FDEC25926E885675B4E759E539F584C93E6A4A25F10FEF6C8B6AE047330C5B0408CA4A6310F28FC1112480187DE0DE01C5212D38089CE15EE355EA942BA39B65349D19F52F88008A082EF25587C8464CE1F86B6F8B4AD73B4805EDE6244F51C6118D3CC29C76E25D93BED5A71A5F1FF053D4E4598315BE91D41222A89499C462A932BF088E6893D1AD56B5BB71027DDEC0185B92049D7BD845FC19906FE6D808B8972EFFD04D039149E3209B443C64144DDDAF2064EE97D063EB9862766BEF5EA731D18CC15B3AED74DE082F78FE53A8223FE10D0676733A230D1AD8824857FC6DF13E4AFEEE402906886A0D74CAC7DEE051B05944297E7EE9045B540F81C20DD4BD18702D9D1FB8807B9B3B7C4833C6498AE314766E302F3CEFB94516579F53E25582903D60A55E53A9F1AACF2D6D770D519AE2688E367D833B71367361233B717CC3A1291E6C8B39263D7A38ED6F3FB8A8B855F16E3EE4BF75717DA304C1B8C9AC6F61297FA3ED8A8745FE3D6C6D2ACD7C3CD3AD9C21A6EAB0B356D2E6EE6B6912F9F7B6A4ABF60E718CCCBEB995E6E262A3CFA765E61400F52BC140697815E35E325F4A7906632FF1C0A687C023812DF078AC52B436F4839F4B07DE88F68560C3D6A1F7A473E93E00B2986BF554D971A496E3C612C70516284CAB656499AAB4CCF88677567D092076659FFA5D03B0A85A6057E62B9EBE1F09A9C420C39B44EDCF4866D04980B3CD57B8420DE0A4B2AB6AAFA92E42DA5BAB8EF149E2246431A07498047C229057010E16A4047C44521C09DFAA9CD34DC0C62D90B1EF59E53184212C7F14E4D98302F2FB1D425149C6A66E9D2D1C091D0D60E42257FD2D95B9F4C95D62E83E44620A83FB875F9444FB0D3E96403A0D3C96EC25A4E2EB60ABAA6FDB5CBD8AD9BAD0AC555428F19B306906D04F76B21B445900D82B5C5763B88DB34011373B898516CFE27616CDEF4883C8D3B9343B99267DD3198A55A2C4B4DEB588B898F21D73C2A89F36499006A375305C04D44F5A43A09E41A6F225182DE9048BB704D0E5B232CD9A92E63F5EA511AA8BFA0AC03C828DB2A649394AB40D1284952285524A84783AAE8066A51EF4554A5B4EFFD66BBBF2486049616956837ED6ED5AEA186C6939C5E239D1BD3CA5B53839E5A0CBEF26664628616F5E5A7CD22D89555044E5A4690971B389A7A83C1250843718693EA0FB2166B9C161F8CDE8C577F8CF7531A8ECB1ADEE48BD5169C7840C11CD67A056BB1D27344198FAF43A6203E188F3C5F19D618DA35B12D67A98BDEAA39F37897CF8CBFD3D92D65196ACC5737CA8CE0B9103D1E916801B684179544522C0230A00D375EA300473ED1A701FAD9E5C946A6A13FEFE829A5B7583295B4C59C4279632553295BCD29A5F7543295B445A530706A9651521605144A0E5845DB0A58EC1B814FC6DDA6D02627873295B6A4514F2D7D6A91E9A42D2BA03F7B13AA603F6B33A7527D8D9169557BCC29569F64648AD51E738ACAAB73C588F5CE9DF193729FECCB5374A98281AFE8A73E8FB764EFA21580A74D9B46F8FA9EB64B3EB2652C3F4706D270307B3ABE379F85F4BB2FBC66224AB77276A80F29B8176788DA596190E5EDDD05CC4A229F0EB12DA19A47E4C549FC78C938F453E88EFFC0238C92AB847CC0252068262C9FBE40D947078747B5D2E7DD29437618F370C3B9A7AD16B96AB70DBC85A358BB9DAFDD2B3E06D72B7B516331C205F1E06268FF994C3AB62E7EBFCFE7ED59D75418FBD83AB0FE5AEBCDFC11D069F26CFE8D0F16DFCAA44C6A69EAEFE489186BBC8B13B11CF7015083C5AC5A39FB3270A3964D9822A79CB91676E412AD15ACD5E0019592B2B54835557479E29BF755D1D544CC64619A72D529EAF292D56B2D5F06BC2BD58CBB02AFDE20BF23385DA760EE65C06CEB51F445EFC03D14026DBBEA477EA3DB56B1CFE62A7B5A0FBEFFFF829E6D56F018C3B9E7829DCD8167170B1BFA2DC8D9850A304D407A4A11D0CEE3CAE83E6EEB186B2E9E511F6235D79BBAEB0D93A298F44E48A47BD340A021DD9EBB4B2C9A59B794CEE8D974132FDDA4A5ACA68981FE71BFBBEAC6B0E8A68D6D9B02375B9DD3502F625089A32AA3F9857C67EB6F1A2B3D0C043750D7AE57D7AC2EBADE05746F12CF5231A3DE6E8BB82AFD110F11E1199A9724E23FE941A05B89A8C5980B320BF2E05E5B513EA47E12861C88932F38A11CCD80CB45B70B1943D2AF469CF953E85D90EB8887111722437F8A2BBFA2146F106DFC93B2A0EA9A07D76112A8FA10412C13C587F76BF22142D82BD67DDE7035A42111EF3CD91139B6258F8FCAF36541E92A20868432F5151BE604FA2116C4D835198347F894B5DD31F811CE81BBCC1F29F444BA0D5155FBE0148139053ECB6894F3C58F02C39EBF78F71F3D5EA146CB460000 , N'6.1.3-40302')
END

